"""
Exploit validation (no exploitation)
MITRE: T1203
"""
import subprocess

def metasploit_check(context):
   """
   exploits.metasploit_check
   Verifica servizi noti in Metasploit
   """
   target_ip = context.assets.get("gateway_ip")
   if not target_ip:
       return {
           "status": "error",
           "raw": "",
           "summary": "Nessun target per Metasploit"
       }
   cmd = f"msfconsole -q -x 'db_nmap -sV {target_ip}; exit'"
   result = subprocess.run(cmd, shell=True, capture_output=True, text=True)
   return {
       "status": "success",
       "raw": result.stdout,
       "summary": "Validazione servizi noti via Metasploit"
   }